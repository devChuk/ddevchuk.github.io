// if you're curious about implmentation, just replace min with dev :)

function p(e){return Math.pow(e,2)}function sqrt(e){return Math.sqrt(e)}function map_range(e,n,r,t,a){return t+(a-t)*(e-n)/(r-n)}function reset(){this.scene=new THREE.Scene,setup()}function distanceBetweenDimTwo(e,n){return sqrt(p(e.x-n.x)+p(e.y-n.y))}function scalarPtMultiply(e,n){return{x:e*n.x,y:e*n.y}}function pointAdd(e,n){return{x:e.x+n.x,y:e.y+n.y}}function onWindowResize(){vw=window.innerWidth,vh=window.innerHeight,camera.aspect=vw/vh,camera.updateProjectionMatrix(),renderer.setSize(vw,vh),canvas=document.getElementById("twoDimCanvas"),canvas.width=vw,canvas.height=vh,_stage==STAGE.STAG&&(moveStag(-distMovedX,0),moveStag(vw-origVW,0))}function areaOfTriangle(e,n){var r=n[0],t=n[1],a=n[2];return Math.abs((e[r].x-e[a].x)*(e[t].y-e[r].y)-(e[r].x-e[t].x)*(e[a].y-e[r].y))/2}function onSeg(e,n,r){return distanceBetweenDimTwo(e,n)+distanceBetweenDimTwo(n,r)==distanceBetweenDimTwo(e,r)}function orientation(e,n,r){var t=(n.y-e.y)*(r.x-n.x)-(n.x-e.x)*(r.y-n.y);return 0==t?0:t>0?1:2}function doIntersect(e,n,r,t){var a=orientation(e,n,r),s=orientation(e,n,t),i=orientation(r,t,e),o=orientation(r,t,n);return 0==a&&onSeg(e,r,n)?!1:0==s&&onSeg(e,t,n)?!1:0==i&&onSeg(r,e,t)?!1:0==o&&onSeg(r,n,t)?!1:a!=s&&i!=o?!0:!1}function lineSegExitsPolygn(e,n,r){if(e.y>=530&&n.y>=530)return!1;for(var t=80;310>t;t++){var a=r[t],s=r[t+1];if(1==doIntersect(a,s,e,n))return!0}return!1}function projectToScreen(e){var n=e.clone(),r=document.documentElement.clientWidth/2,t=document.documentElement.clientHeight/2;return n.project(camera),n.x=n.x*r+r,n.y=-(n.y*t)+t,n.z=0,n}function projectModelVertices(e){for(var n=vertices.length,r=0;r<e.geometry.vertices.length;r++)vertices.push(e.geometry.vertices[r].clone()),vertices[r+n].applyMatrix4(e.matrixWorld),vertices[r+n]=projectToScreen(vertices[r+n])}function genProjectedVertices(e,n){e.updateMatrixWorld();for(var r=0;r<e.geometry.vertices.length;r++){var t=e.geometry.vertices[r].clone();t.applyMatrix4(e.matrixWorld),t=projectToScreen(t),delete t.z,n.push(t)}}function genRandPtOutsideScreen(e,n){var r,t=2*(canvas.width+canvas.height),a=null!=n&&-1!==n.indexOf("LEFT"),s=null!=n&&-1!==n.indexOf("RIGHT"),i=250;r=a?Math.random()*canvas.height:s?Math.random()*canvas.height+canvas.width+canvas.height:Math.random()*t,a||r>0&&r<canvas.height?e.push({x:Math.random()*-i,y:r}):canvas.height<r&&r<canvas.height+canvas.width?e.push({x:r-canvas.height,y:canvas.height+Math.random()*i}):s||r<2*canvas.height+canvas.width&&r>canvas.height+canvas.width?e.push({x:canvas.width+Math.random()*i,y:r-canvas.height-canvas.width}):e.push({x:r-2*canvas.height-canvas.width,y:Math.random()*-i})}function genRandPtFromTriangles(e,n,r){var t;t=r?Math.random()*r:Math.random();for(var a=-1;t>=0&&a<=n.aR.length-1;)t-=n.aR[++a];if(void 0==n.i[a])return void console.log(a);var s=n.v[n.i[a][0]],i=n.v[n.i[a][1]],o=n.v[n.i[a][2]],l=Math.random(),d=Math.random();s=pointAdd(scalarPtMultiply(1-sqrt(l),s),scalarPtMultiply(sqrt(l)*(1-d),i)),e.push(pointAdd(scalarPtMultiply(sqrt(l)*d,o),s))}function triangulate(e,n){for(var r=[],t=[],a=[],s=0;s<e.length;s++)r.push(e[s].x),r.push(e[s].y);if(n)for(var s=0;s<n.length;s++){t.push(r.length/2);for(var i=0;i<n[s].length;i++){var o=n[s][i];r.push(o.x),r.push(o.y)}}for(var l=earcut(r,t),s=0;s<l.length;s+=3)a.push([l[s],l[s+1],l[s+2]]);return a}function genTriangles(e,n,r){if(e.i=triangulate(n,r),e.v=n,r)for(var t=0;t<r.length;t++)e.v=e.v.concat(r[t]);for(var a=0,s=[],i=0;i<e.i.length;i++){var o=areaOfTriangle(e.v,e.i[i]);s.push(o),a+=o}for(var t=0;t<s.length;t++)e.aR.push(s[t]/a)}function populateWithRandomPts(e,n,r,t){for(var a=n.length,s=a;a+e>s;s++){genRandPtFromTriangles(n,r,t),n[s].conn=[];var i=Math.random()*randDistThres;25>i&&(i=25),proxThres.push(i)}}function setupPtObj(e,n,r,t){for(var a=e;a<e+r.length;a++){n[a].conn=[];var s;t?s=60:(s=Math.random()*randDistThres,25>s&&(s=25)),proxThres.push(s)}}function drawLine(e,n,r){r.beginPath(),r.moveTo(e.x,e.y),r.lineTo(n.x,n.y),r.stroke()}function drawConnections(e,n){for(var r=0;r<vertices.length;r++)for(var t=r+1;t<vertices.length;t++){var a=distanceBetweenDimTwo(vertices[r],vertices[t]);e>a&&(n.strokeStyle="#ffffff",n.globalAlpha=map_range(a,0,e,.5,0),drawLine(vertices[r],vertices[t],n))}}function drawConnectionsForStars(e,n){for(var r=0;r<vertices.length;r++)for(var t=r+1;t<vertices.length;t++){var a=distanceBetweenDimTwo(vertices[r],vertices[t]);e>a&&(n.strokeStyle="#ffffff",n.globalAlpha=map_range(a,0,e,.3,0),drawLine(vertices[r],vertices[t],n))}}function drawConnectionsInOrder(e,n,r){var t;r&&(t=0);for(var a=0;a<e.length-1;a++)if(r&&t!=r.length&&a===r[t])t++;else{var s=distanceBetweenDimTwo(e[a],e[a+1]);n.globalAlpha=map_range(s,0,18,.8,.2)*lazyFadeIn,drawLine(e[a],e[a+1],n)}}function drawConnectionsInOrderFull(e,n,r){var t;r&&(t=0);for(var a=0;a<e.length-1;a++)if(r&&t!=r.length&&a===r[t])t++;else{var s=distanceBetweenDimTwo(e[a],e[a+1]);n.globalAlpha=map_range(s,0,18,.8,.2),drawLine(e[a],e[a+1],n)}}function drawEars(e,n,r){for(var t=0;t<e.length;t++){for(var a=t+1;a<e.length;a++){var s=distanceBetweenDimTwo(e[t],e[a]);earCloseEnough>s&&(r.strokeStyle="#ffffff",r.globalAlpha=map_range(s,0,earCloseEnough,.5,0)*lazyFadeIn,drawLine(e[t],e[a],r))}for(var a=0;a<n.length;a++){var s=distanceBetweenDimTwo(e[t],n[a]);earCloseEnough>s&&(r.strokeStyle="#ffffff",r.globalAlpha=map_range(s,0,earCloseEnough,.5,0)*lazyFadeIn,drawLine(e[t],n[a],r))}}}function fillPolygon(e,n){e.beginPath(),e.globalAlpha=1;for(var r=0;r<n.length;r++)e.lineTo(n[r].x,n[r].y);e.closePath(),e.fill()}function moveStag(e,n){distMovedX+=e,distMovedY+=n;for(var r=0;r<STAG_VERTICES.length;r++)for(var t=0;t<STAG_VERTICES[r].length;t++)STAG_VERTICES[r][t].x+=e,STAG_VERTICES[r][t].y+=n;for(var r=0;r<innerBorderPts.length;r++)innerBorderPts[r].x+=e,innerBorderPts[r].y+=n}function initMeshes(){var e=new THREE.JSONLoader;sphereM=new THREE.Mesh(new THREE.SphereGeometry(300,15,15));for(var n=canvas.width*canvas.height>55e4?500:256,r=0;n>r;r++)starFieldM.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height}),starVelocities.push({dx:.4*Math.random()-.2,dy:.4*Math.random()-.2});e.load("./res/models/sBorder.json",function(e){sBorderM=new THREE.Mesh(e),STAG_MODELS.push(sBorderM)}),e.load("./res/models/sEye.json",function(e){sEyeM=new THREE.Mesh(e),STAG_MODELS.push(sEyeM)}),e.load("./res/models/sEyeDetail.json",function(e){sEyeDetailM=new THREE.Mesh(e),STAG_MODELS.push(sEyeDetailM)}),e.load("./res/models/sEarL.json",function(e){sEarLM=new THREE.Mesh(e),STAG_MODELS.push(sEarLM)}),e.load("./res/models/sEarR.json",function(e){sEarRM=new THREE.Mesh(e),STAG_MODELS.push(sEarRM)}),e.load("./res/models/sSnout.json",function(e){sSnoutM=new THREE.Mesh(e),STAG_MODELS.push(sSnoutM)}),e.load("./res/models/sSnoutBridge.json",function(e){sSnoutBridgeM=new THREE.Mesh(e),STAG_MODELS.push(sSnoutBridgeM)}),e.load("./res/models/sSnoutDetailA.json",function(e){sSnoutDetailAM=new THREE.Mesh(e),STAG_MODELS.push(sSnoutDetailAM)}),e.load("./res/models/sSnoutDetailB.json",function(e){sSnoutDetailBM=new THREE.Mesh(e),STAG_MODELS.push(sSnoutDetailBM)}),e.load("./res/models/sAntlerDetail.json",function(e){sAntlerDetailM=new THREE.Mesh(e),STAG_MODELS.push(sAntlerDetailM)})}function startTransition(e){switch(_goalPointsSatisfied=[],_distanceTravelled=[],_goalPoints=[],e){case STAGE.STARFIELD:_goalPoints=starFieldM;for(var n=0;250>n;n++)_distanceTravelled.push(0);if(vertices.length<starFieldM.length){vertices.length=250;for(var n=250;n<starFieldM.length;n++)genRandPtOutsideScreen(vertices,"LEFT"),_distanceTravelled.push(0)}break;case STAGE.STAG:setupStag();for(var n=0;n<starFieldM.length;n++)n<sBorderV.length?(_goalPoints.push(sBorderV[n]),n>=1&&_sGoalDistance.push(distanceBetweenDimTwo(_goalPoints[n-1],_goalPoints[n]))):genRandPtOutsideScreen(_goalPoints,"RIGHT"),_distanceTravelled.push(0)}for(var n=0;n<_goalPoints.length;n++)_goalPointsSatisfied.push(!1);_goalPoints.length<vertices.length&&(vertices.length=_goalPoints.length),_stage=STAGE.TRANSITION,_newStage=e,transitionTo(e,_goalPoints)}function transitionTo(e){var n=!0;_goalMovements=[],_speeds=[];for(var r=0;r<vertices.length;r++){var t=_goalPoints[r].x-vertices[r].x,a=_goalPoints[r].y-vertices[r].y,s=sqrt(p(t)+p(a)),i=_distanceTravelled[r]/(s+_distanceTravelled[r]),o=.3,l=.4,d=0,c=!1,g=!1;e===STAGE.STARFIELD&&r>=250?c=!0:e===STAGE.STAG&&r>=sBorderV.length&&(g=!0),d=o>i&&!c?map_range(i,0,o,.5,20):l>=i?20:i>=l&&!g?map_range(i,l,1,20,3):20,_goalMovements.push({dx:t/s*d,dy:a/s*d}),_distanceTravelled[r]+=d,_speeds.push(d)}for(var r=0;r<vertices.length;r++)0==_goalPointsSatisfied[r]?(n=!1,sqrt(p(_goalPoints[r].x-vertices[r].x)+p(_goalPoints[r].y-vertices[r].y))>_speeds[r]?(vertices[r].x+=_goalMovements[r].dx,vertices[r].y+=_goalMovements[r].dy):(_goalPointsSatisfied[r]=!0,vertices[r].x=_goalPoints[r].x,vertices[r].y=_goalPoints[r].y)):1==_goalPointsSatisfied[r]&&(vertices[r].x=_goalPoints[r].x,vertices[r].y=_goalPoints[r].y);var h=!0;if(e==STAGE.STAG&&closeEnough>finalcloseEnough&&(h=!1),n&&h)switch(_stage=e,e){case STAGE.STARFIELD:sphereM.geometry.dispose(),sphereM.material.dispose(),sphereM=void 0;break;case STAGE.STAG:sBorderM.geometry.dispose(),sBorderM.material.dispose(),sBorderM=void 0,sEyeM.geometry.dispose(),sEyeM.material.dispose(),sEyeM=void 0,sEarLM.geometry.dispose(),sEarLM.material.dispose(),sEarLM=void 0,sEarRM.geometry.dispose(),sEarRM.material.dispose(),sEarRM=void 0,sSnoutM.geometry.dispose(),sSnoutM.material.dispose(),sSnoutM=void 0,starFieldM=void 0,starVelocities=void 0,_distanceTravelled=void 0,_goalPoints=void 0,_goalMovements=void 0,_goalPointsSatisfied=void 0,_speeds=void 0,_newStage=void 0,_sFadeIn=void 0,_sGoalDistance=void 0}}function renderTransitions(e){switch(_newStage){case STAGE.STARFIELD:for(var n=0;n<starFieldM.length;n++)starFieldM[n].x+=starVelocities[n].dx,starFieldM[n].y+=starVelocities[n].dy,(starFieldM[n].x<0||starFieldM[n].x>canvas.width)&&(starVelocities[n].dx*=-1),(starFieldM[n].y<0||starFieldM[n].y>canvas.height)&&(starVelocities[n].dy*=-1),_goalPoints[n]=starFieldM[n];break;case STAGE.STAG:for(var n=0;n<sBorderV.length;n++)if(_goalPoints[n]=sBorderV[n],n<sBorderV.length-1){var r=distanceBetweenDimTwo(vertices[n],vertices[n+1]);(70>r||r<1.001*_sGoalDistance[n])&&(e.globalAlpha=map_range(r,0,18,.8,.1)*_sFadeIn,e.beginPath(),e.moveTo(vertices[n].x,vertices[n].y),e.lineTo(vertices[n+1].x,vertices[n+1].y),e.strokeStyle="#ffffff",e.stroke())}closeEnough>finalcloseEnough&&(closeEnough-=.5),1>=_sFadeIn&&finalcloseEnough>=closeEnough-50&&(_sFadeIn+=.01)}switch(transitionTo(_newStage),_newStage){case STAGE.STARFIELD:drawConnectionsForStars(closeEnough,e);break;case STAGE.STAG:drawConnections(closeEnough,e)}}function renderSphere(e){vertices=[],genProjectedVertices(sphereM,vertices),drawConnectionsForStars(closeEnough,e),sphereM.rotation.x=mouseY,sphereM.rotation.y=mouseX,sphereM.rotation.x+=sphereX,sphereM.rotation.y+=sphereY,sphereX+=.001,sphereY+=.001,sphereM.rotation.z+=.001}function renderStarfield(e){vertices=[];for(var n=0;n<starFieldM.length;n++)starFieldM[n].x+=starVelocities[n].dx,starFieldM[n].y+=starVelocities[n].dy,(starFieldM[n].x<0||starFieldM[n].x>canvas.width)&&(starVelocities[n].dx*=-1),(starFieldM[n].y<0||starFieldM[n].y>canvas.height)&&(starVelocities[n].dy*=-1),vertices.push(starFieldM[n]);drawConnectionsForStars(closeEnough,e)}function reAdjustStag(){origVW=vw;for(var e=200,n=510+(-1865+vw)/2.8,r=-40,t=0;t<STAG_MODELS.length;t++)STAG_MODELS[t].scale.x=STAG_MODELS[t].scale.y=e,STAG_MODELS[t].translateX(n),STAG_MODELS[t].translateY(r)}function setupStag(){reAdjustStag(),genProjectedVertices(sBorderM,sBorderV),genProjectedVertices(sEyeM,sEyeV),genProjectedVertices(sEyeDetailM,sEyeDetailV),genProjectedVertices(sEarLM,sEarLV),genProjectedVertices(sEarRM,sEarRV),genProjectedVertices(sSnoutM,sSnoutV),genProjectedVertices(sSnoutBridgeM,sSnoutBridgeV),genProjectedVertices(sSnoutDetailAM,sSnoutDetailAV),genProjectedVertices(sSnoutDetailBM,sSnoutDetailBV),genProjectedVertices(sAntlerDetailM,sAntlerDetailV),genTriangles(baseTriangles,sBorderV,[sEyeV,sSnoutV]),genTriangles(leftEarTriangles,sEarLV),genTriangles(rightEarTriangles,sEarRV),genTriangles(snoutTriangles,sSnoutV);for(var e={v:baseTriangles.v,i:[],aR:[]},n=0,r={v:baseTriangles.v,i:[],aR:[]},t=0,a=0;a<baseTriangles.i.length;a++){var s=baseTriangles.v[baseTriangles.i[a][0]],i=baseTriangles.v[baseTriangles.i[a][1]],o=baseTriangles.v[baseTriangles.i[a][2]];360<=s.y&&s.y<=530&&360<=i.y&&i.y<=530&&360<=o.y&&o.y<=530&&(e.i.push(baseTriangles.i[a]),e.aR.push(baseTriangles.aR[a]),n+=baseTriangles.aR[a]),s.y<=390&&i.y<=390&&o.y<=390&&(r.i.push(baseTriangles.i[a]),r.aR.push(baseTriangles.aR[a]),t+=baseTriangles.aR[a])}populateWithRandomPts(numInnerStagPts,innerBorderPts,baseTriangles),populateWithRandomPts(numHeadStagPts,innerBorderPts,e,n);for(var l=0;20>l;l++)genRandPtFromTriangles(leftEarPts,leftEarTriangles),genRandPtFromTriangles(rightEarPts,rightEarTriangles);var d=innerBorderPts.length;innerBorderPts=innerBorderPts.concat(sEyeDetailV),setupPtObj(d,innerBorderPts,sEyeDetailV),d=innerBorderPts.length,innerBorderPts=innerBorderPts.concat(sSnoutV),setupPtObj(d,innerBorderPts,sSnoutV),d=innerBorderPts.length,innerBorderPts=innerBorderPts.concat(sSnoutBridgeV),setupPtObj(d,innerBorderPts,sSnoutBridgeV,60),innerSnoutPts=sSnoutDetailBV;for(var l=0;l<innerSnoutPts.length;l++)innerSnoutPts[l].conn=[];for(var l=0;l<innerSnoutPts.length;l++)for(var a=l;a<innerSnoutPts.length;a++){var c=distanceBetweenDimTwo(innerSnoutPts[l],innerSnoutPts[a]);if(8>c){var s=.1;innerSnoutPts[l].conn.push({index:a,alpha:s})}}populateWithRandomPts(100,innerBorderPts,r,t),mainStagV=innerBorderPts.concat(sBorderV);for(var l=0;d>l;l++)for(var a=l+1;a<mainStagV.length;a++)if(d>a||a>d+sSnoutBridgeV.length){var g=a<sBorderV.length,c=distanceBetweenDimTwo(innerBorderPts[l],mainStagV[a]);if((g&&50>c||c<proxThres[l])&&!lineSegExitsPolygn(innerBorderPts[l],mainStagV[a],sBorderV)){var s;s=g&&50>c?map_range(c,0,100,.1,.04):map_range(c,0,proxThres[l],.1,.04),innerBorderPts[l].conn.push({index:a,alpha:s})}}for(var l=d;l<d+sSnoutBridgeV.length;l++)for(var a=0;a<sSnoutV.length;a++){var c=distanceBetweenDimTwo(innerBorderPts[l],sSnoutV[a]);if(c<proxThres[l]){var s=map_range(c,0,proxThres[l],.1,.07);innerBorderPts[l].conn.push({index:a,alpha:s})}}}function renderStag(e){1>=lazyFadeIn&&(lazyFadeIn+=.01),vertices=[],e.strokeStyle="#ffffff";for(var n=0;n<innerBorderPts.length;n++)for(var r=0;r<innerBorderPts[n].conn.length;r++){var t=270;e.globalAlpha=innerBorderPts[n].conn[r].alpha*lazyFadeIn;var a;a=t>n||n>=t+sSnoutBridgeV.length?mainStagV[innerBorderPts[n].conn[r].index]:sSnoutV[innerBorderPts[n].conn[r].index],drawLine(innerBorderPts[n],a,e)}for(var n=0;n<innerSnoutPts.length;n++)for(var r=0;r<innerSnoutPts[n].conn.length;r++){e.globalAlpha=innerSnoutPts[n].conn[r].alpha*lazyFadeIn;var a=innerSnoutPts[innerSnoutPts[n].conn[r].index];drawLine(innerSnoutPts[n],a,e)}drawConnectionsInOrderFull(sBorderV,e),drawConnectionsInOrder(sSnoutV,e),drawConnectionsInOrder(sSnoutDetailAV,e),drawConnectionsInOrder(sAntlerDetailV,e,[23,46,62,67]),drawEars(leftEarPts,sEarLV,e),drawEars(rightEarPts,sEarRV,e),e.fillStyle="#CECECE",fillPolygon(e,sEyeV)}function tempTriangleDraw(e,n){for(var r=0;r<n.i.length;r++)e.fillStyle=triangleColors[r],e.globalAlpha=1,e.beginPath(),e.moveTo(n.v[n.i[r][0]].x,n.v[n.i[r][0]].y),e.lineTo(n.v[n.i[r][1]].x,n.v[n.i[r][1]].y),e.lineTo(n.v[n.i[r][2]].x,n.v[n.i[r][2]].y),e.closePath(),e.fill(),e.strokeStyle="#ffff00",e.stroke()}var vw=window.innerWidth,vh=window.innerHeight,scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,vw/vh,.1,1e3),renderer=new THREE.WebGLRenderer({antialias:!0}),renderID;camera.position.z=655;var canvas,startTime,STAGE={TRANSITION:0,SPHERE:1,STARFIELD:2,STAG:3},closeEnough=130,sphereM,starFieldM=[],starVelocities=[],sBorderM,sEyeM,sEyeDetailM,sEarLM,sEarRM,sSnoutM,sSnoutBridgeM,sSnoutDetailAM,sAntlerDetailM,sBorderV=[],sEyeV=[],sEyeDetailV=[],sEarLV=[],sEarRV=[],sSnoutV=[],sSnoutBridgeV=[],sSnoutDetailAV=[],sSnoutDetailBV=[],sAntlerDetailV=[],_stage=STAGE.SPHERE,vertices,_distanceTravelled,_goalPoints,_goalMovements,_goalPointsSatisfied,_speeds,_newStage,_sFadeIn=0,_sGoalDistance=[],earCloseEnough=35,finalcloseEnough=10,randDistThres=100,numInnerStagPts=230,numHeadStagPts=20,proxThres=[],lazyFadeIn=0,baseTriangles={v:[],i:[],aR:[]},leftEarTriangles={v:[],i:[],aR:[]},rightEarTriangles={v:[],i:[],aR:[]},snoutTriangles={v:[],i:[],aR:[]},innerBorderPts=[],leftEarPts=[],rightEarPts=[],mainStagV=[],innerSnoutPts=[],STAG_VERTICES=[sBorderV,sEyeV,sEarLV,sEarRV,sSnoutDetailAV,sSnoutDetailBV,sAntlerDetailV,leftEarPts,rightEarPts,mainStagV,innerSnoutPts],STAG_MODELS=[],origMouseX=0,origMouseY=0,mouseX=0,mouseY=0,firstMove=!0,sphereX=0;sphereY=0;var distMovedX=0,distMovedY=0,origVW=vw,triangleColors=[];window.addEventListener("resize",onWindowResize,!1);var setup=function(){renderer.setSize(vw,vh),container=document.createElement("div"),document.body.appendChild(container),canvas=document.getElementById("twoDimCanvas"),canvas.width=vw,canvas.height=vh,starFieldM=[],starVelocities=[],initMeshes()},render=function(){renderID=window.requestAnimationFrame(render),window.innerWidth<=991&&cancelAnimationFrame(renderID);var e=canvas.getContext("2d");switch(e.clearRect(0,0,canvas.width,canvas.height),_stage){case STAGE.TRANSITION:renderTransitions(e);break;case STAGE.SPHERE:renderSphere(e);break;case STAGE.STARFIELD:renderStarfield(e);break;case STAGE.STAG:renderStag(e)}var n=Date.now()-startTime;n>8e3&&_stage==STAGE.SPHERE?startTransition(STAGE.STARFIELD):n>18e3&&_stage==STAGE.STARFIELD&&startTransition(STAGE.STAG),renderer.render(scene,camera)};THREE.DefaultLoadingManager.onLoad=function(){setTimeout(function(){startTime=Date.parse(new Date),render(),fadeIn(canvas,1e3)},1e3)},THREE.DefaultLoadingManager.onError=function(e){console.log("There was an error loading "+e)},setup();